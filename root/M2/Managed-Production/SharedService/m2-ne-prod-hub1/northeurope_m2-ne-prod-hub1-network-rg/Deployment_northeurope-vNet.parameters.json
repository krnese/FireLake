{
  "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentParameters.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "vNetDefinition": {
      "value": {
        "vnetName": "m2-ne-prod-hub1",
        "vnetAddressPrefix": "10.1.0.0/20",
        "dnsServers": [
          "10.1.6.4",
          "10.1.5.4",
          "10.1.5.5"
        ],
        "subnetlist": [
          {
            "name": "m2-ne-prod-hub1-er-gw",
            "addressPrefix": "10.1.1.0/24"            
          },
          {
            "name": "m2-ne-prod-hub1-vpn-gw",
            "addressPrefix": "10.1.2.0/24",
            "virtualNetworkGateways": [
              {
                "name": "vpngateway",
                "privateIPAllocationMethod": "Dynamic",
                "publicIPAddress": "Dynamic",
                "gatewayType": "Vpn",
                "vpnType": "RouteBased",
                "enableBgp": "true"
              }
            ]
          },
          
          {
            "name": "AzureFirewallSubnet",
            "addressPrefix": "10.1.3.0/24"
          },
          {
            "name": "m2-ne-prod-hub1-firewall",
            "addressPrefix": "10.1.4.0/24"
          },
          {
            "name": "m2-ne-prod-hub1-aad-ds",
            "addressPrefix": "10.1.5.0/24"
          },
          {
            "name": "m2-ne-prod-hub1-ad-ds",
            "addressPrefix": "10.1.6.0/24",
            "routetablename": "m2-ne-prod-hub1-ad-ds-routetable"
          },
          {
            "name": "m2-ne-prod-hub1-file-share",
            "addressPrefix": "10.1.7.0/24"
           
          },
          {
            "name": "m2-ne-prod-hub1-jumpbox",
            "addressPrefix": "10.1.8.0/24",
            "routetablename": "m2-ne-prod-hub1-jumpbox-routetable",
            "nsgname": "m2-ne-prod-hub1-jumpbox-nsg"
          }      
        ],
        "routeTables": [
          {
            "name": "m2-ne-prod-hub1-ad-ds-routetable",
            "routes": [
              {
                "name": "internet",
                "addressPrefix": "0.0.0.0/0",
                "nextHopType": "Internet"
              }
            ]
          },
          {
            "name": "m2-ne-prod-hub1-jumpbox-routetable",
            "routes": [
              {
                "name": "intenret",
                "addressPrefix": "0.0.0.0/0",
                "nextHopType": "Internet"
              }
            ]
          }
         
        ],
        "networkSecurityGroups": [
          {
            "name": "m2-ne-prod-hub1-jumpbox-nsg",
            "securityRules": [
              {
                "name": "rdp_rule1",
                "properties": {
                  "description": "Allow RDP",
                  "protocol": "Tcp",
                  "sourcePortRange": "*",
                  "destinationPortRange": "3389",
                  "sourceAddressPrefix": "Internet",
                  "destinationAddressPrefix": "*",
                  "access": "Allow",
                  "priority": 100,
                  "direction": "Inbound",
                  "sourceApplicationSecurityGroups": "",
                  "destinationApplicationSecurityGroups": ""
                }
              }
            ]
          }
        ],
        "connections": [
          
        ],
        "virtualNetworkPeerings": [
            {              
              "properties": {
                "remoteVirtualNetwork": {
                  "id": "/subscriptions/926ab52d-a877-4db3-b0f9-2e9f8ecbe4c4/resourceGroups/m2-we-prod-hub1-network-rg/providers/Microsoft.Network/virtualNetworks/m2-we-prod-hub1"
                },
                "allowVirtualNetworkAccess": "true",
                "allowForwardedTraffic": "true",
                "allowGatewayTransit": "false",
                "useRemoteGateways": "false"
              }
            },
            {              
              "properties": {
                "remoteVirtualNetwork": {
                  "id": "/subscriptions/c14f781e-159f-45b9-9538-56d9dd32d5e0/resourceGroups/m2-ne-prod-hub1-spoke1-network-rg/providers/Microsoft.Network/virtualNetworks/m2-we-prod-hub1-spoke1"
                },
                "allowVirtualNetworkAccess": "true",
                "allowForwardedTraffic": "true",
                "allowGatewayTransit": "false",
                "useRemoteGateways": "false"
              }
            }

        ],      
        
        "azureFirewalls": [
         {
            "name": "cnfw-ne-prod-hub1-fw",
            "azureFirewallspublicIPAddressName": "cnfw-ne-prod-hub1",
            "properties": {
              "ipConfigurations": [
                {
                  "name": "IpConf",
                  "properties": {
                    "subnet": {
                      "id": "[resourceId('Microsoft.Network/virtualNetworks/subnets', parameters('vNetDefinition').vnetName, 'AzureFirewallSubnet')]"
                    },
                    "InternalPublicIPAddress": {
                      "id": "[resourceId('Microsoft.Network/publicIPAddresses','cnfw-ne-prod-hub1')]"
                      
                    }
                  }
                }
              ],
              "applicationRuleCollections": [
                {
                  "name": "appRc1",
                  "properties": {
                    "priority": 101,
                    "action": {
                      "type": "Allow"
                    },
                    "rules": [
                      {
                        "name": "appRule1",
                        "protocols": [
                          {
                            "port": "80",
                            "protocolType": "http"
                          },
                          {
                            "port": "443",
                            "protocolType": "https"
                          }
                        ],
                        "targetUrls": [
                          "*microsoft.com"
                        ]
                      }
                    ]
                  }
                }
              ],
              "networkRuleCollections": [
                {
                  "name": "netRc1",
                  "properties": {
                    "priority": 200,
                    "action": {
                      "type": "Allow"
                    },
                    "rules": [
                      {
                        "name": "netRule1",
                        "protocols": [
                          "TCP"
                        ],
                        "sourceAddresses": [
                          "192.168.2.0/24"
                        ],
                        "destinationAddresses": [
                          "*"
                        ],
                        "destinationPorts": [
                          "8000-8999"
                        ]
                      }
                    ]
                  }
                }
              ]
            }
         }
        ]
      }
    }
  }
}